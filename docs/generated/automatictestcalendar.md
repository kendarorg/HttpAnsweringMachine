
<!--This file is autogenerated. Do not edit!-->
In this demo you will 

* Start locally HAM server
* Start the sample application
* Connect to it through proxy
* Record the interactions of the sample application
* Setup a null-infrastructure test with automatic consistency verification. Testing automatically with
  * Simulated Front-end with Back-end 
  * Simulated Back-end to Back-end interaction
* Run stateful reproducible tests!

## Download the last release<a id="quickinstall_01"></a>

Download the two tar.gz, ham and ham-samples from [github releases](https://github.com/kendarorg/HttpAnsweringMachine/releases)
and extract them in the same directory

## Starting the sample application<a id="quickinstall_02"></a>

Go on the "calendar" directory and run "runcalendar.bat/sh"

This will start

* ham (localhost:80)
* be (localhost:8100) proxied by http://localhost/int/be.sample.test
* gateway (localhost:8090) proxied by http://localhost/int/gateway.sample.test
* fe (localhost:8080)

<img src="../images/start_sample.gif" width="200"/>

## The calendar sample project

It's composed of three parts

* FE, that calls gateway for all its needs
* GATEWAY, that acts a "middleman" between FE and BE
* BE, with the database that is called only by the BE
## Configure proxy<a id="proxy_01"></a>

* Chrome:
    * Install [Proxy Switch Omega](https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif)
    * Go to options
    * Add http and https proxy server with
        * Address: 12.0.0.1
        * Port 1081.
      
          <img alt="Ham Proxyes" src="../images/chrome_proxy.gif" width="200"/>
    * Select "proxy" from the extension menu and back to "direct" when you want to disconnect
    * 
      <img alt="Ham Proxyes" src="../images/chrome_proxy_switch.gif" width="100"/>
     
* Firefox
    * Navigate to [about:preferences](about:preferences)
    * Search for "proxy"
    * Click on "Settings"
    * Go to "Manual proxy Configuration"
    * Select the socks5 proxy
        * Address: 12.0.0.1
        * Port 1080
    * Check the "Proxy DNS when using SOCKS v5" flag
    * Clean the settings when needed
  
      <img alt="Ham Proxyes" src="../images/firefox_proxy.gif" width="200"/>
## Record some interaction<a id="recordcalendar_01"></a>

You can now check ham application going on http://www.local.test

* Going on [ham proxyes](http://www.local.test/proxy/index.html) you can verify that all proxies are ok if they don't work just "Refresh Status"

<img alt="Ham Proxyes" src="../images/ham_proxies.gif" width="200"/>

* Navigation on the [application](http://www.sample.test) you can try some interaction

<img alt="Sample application" src="../images/calendar_employees.gif" width="200"/>

* Then you can create a recording on the [recording page](http://www.local.test/plugins/recording)

<img alt="Create recording" src="../images/create_recording.gif" width="200"/>

* Once you create the recording you can start recording!

<img alt="Start recording" src="../images/start_recording.gif" width="200"/>

* Go then on the [application](http://www.sample.test) and do some interaction
  * Add an Employee "John Doe"
  * Go on Appointements
  * Add an Appointment with "Doctor" as description
  * Change the state of the appointament till it shows "Confirmed"
  * Delete the appointment
  * Back on employee, delete the employee too
* And stop the recording!
* Now you will se all the calls on the just created recording

<img alt="Start recording" src="../images/calendar_recorded.gif" width="200"/>

* "Download" the recording as "Sample.json"

## Automatically test and verify backend<a id="automaticcalendar_01"></a>

### Run the interaction with back-end (stateless) and test the GATEWAY in isolation

* Stop the application and restart!
* Delete the script and re-upload Sample.json
* Stop the "fa" application
* Stop the "gateway" application
* Select all the calls to path /int/be.sample.test with the filter and set them as "Stimulated"

<img src="../images/remove_wwwsamplebe.gif" width="300"/>

* Select all the calls to path /int/gateway.sample.test with the filter and set them as "Stimulated"

<img src="../images/remove_wwwsamplegateway.gif" width="300"/>

* Thist a part of result:

<img src="../images/null_gateway_prepare.gif" width="300"/>

* Run the "Null test"
* Check the [results](http://www.local.test/plugins/recording/results.html)!

### Verify the content structure

* Select all the "Stimulator" calls (use "true" as filter on the "Stimulator" column)
* Use the global Edit JS and set for all call the verification script in the "post" part

<pre>
    var diffEngine = new org.kendar.xml.DiffInferrer();
    diffEngine.diff(expectedresponse.getResponseText(),response.getResponseText());
    if(expectedresponse.getStatusCode()!=response.getStatusCode()){
        throw "Expected status code "+expectedresponse.getStatusCode()+" but received "+response.getStatusCode();
    }
</pre>

<img src="../images/verify_structure_script.gif" height="300"/>

* Re run the "Null test"! And be happy
* Check the [results](http://www.local.test/plugins/recording/results.html)!
* Download and save the script as NullAutoTestGateway.json

### Fail the test!

* Find the response to a front-end call
* Insert in the "response body" something fake like

<pre>
{"test":"fail"}
</pre>

* Run the pact test
* Check the FAILED results!

### Test the BE in isolation (stateful)

* Stop the application and restart!
* Delete the script and re-upload Sample.json
* Stop the "fa" application
* Stop the "gateway" application
* Select all the calls to http://localhost/int/be.sample.test with the filter and set them as "Stimulator"

<img src="../images/remove_wwwsamplebe.gif" width="300"/>

* Remove all the gateway and www.sample test calls

* Add the verification of the message on the "Stimulator" page
* Download and save the script as PactBeStatic.json
* Run the pact test
* Check the results!
* Re-run it and... see errors

### Setup the statefulness

* Add variables here and there
* Download and save the script as PactBeDynamic.json
* Run the pact test
* Check the results!
* Re-run it multiple times and see Successes
