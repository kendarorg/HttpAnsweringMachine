<html>
<head>
    <link href="libs/bootstrap.min.css" rel="stylesheet"/>
    <script src="libs/jquery-3.2.1.min.js"></script>
    <script src="libs/bootstrap.min.js"></script>
    <link href="app/app.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div class="row">

        <div class="col-md-8">
            <br>
            <button type="button"  class="btn btn-default" onClick="location.href='index.html'">Back to Scripts</button>
        </div>
        <div class="col-md-8">
            <h3>SCRIPT</h3>
        </div>
        <div class="col-md-8">
            <div class="form-group">
                <label for="id">Id</label>
                <input class="form-control" readonly type="text" name="id" id="id" />
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <input class="form-control" type="text" name="description" id="description" />
            </div>
        </div>
        <div class="col-md-8">
            <table class="table table-striped" id="linesTable">
                <tr>
                    <th>Id</th>
                    <th>Method</th>
                    <th>Host</th>
                    <th>Path</th>
                    <th>Query</th>
                    <th>Res.Status</th>
                    <th>Req.Body</th>
                    <th>Res.Body</th>
                    <th colspan="2"></th>
                </tr>
            </table>
        </div>
    </div>
</div>
<script src="app/app.js"></script>
<script>
    var fields = ['id','request.method','request.host','request.path','_queryCalc','response.statusCode',
        '_responseHashCalc','_requestHashCalc'];
    var linesTable = new SimpleGrid("Request-Response","linesTable","id",fields,
        null,
        function (table,id) {
            location.href = "line.html?line="+id+"&id="+getUrlParameter("id");
        },
        function (table,id) {
            table.deleteFromTable(id,function(id,success,error){
                $.ajax({
                    url: "/api/recording/"+getUrlParameter("id")+"/line/x" + id,
                    type: 'DELETE',
                    success: function (res) {
                        success();
                    },
                    error:function(res){
                        error();
                    }
                });
            });
        },null);


    $.ajax({
        url: "/api/recording/"+getUrlParameter("id"),
        type: 'GET',
        success: function(res) {
            $("#description").val(res['description']);
            $("#id").val(res['id']);
            for(var v=0;v<res["lines"].length;v++) {
                var line =res["lines"][v];
                line['_responseHashCalc']="No";
                line['_requestHashCalc']="No";
                line['_queryCalc']=calculateQuery(line['request']['query']);
                if(line['responseHash']!="0")line['_responseHashCalc']="Yes";
                if(line['requestHash']!="0")line['_requestHashCalc']="Yes";
                //tSource,tableId,id,data,fields
                linesTable.appendToTable(line);
            }
        }
    });

    function calculateQuery(query){
        var result ="";
        $.each(query, function (i, v) {
            if(result!="")result+="&";
            result+=i+"="+v;
        });
        return result;
    }
</script>
</body>
</html>