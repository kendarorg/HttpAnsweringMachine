<html>
<head>
    <link href="libs/bootstrap.min.css" rel="stylesheet"/>
    <script src="libs/jquery-3.2.1.min.js"></script>
    <script src="libs/bootstrap.min.js"></script>
    <link href="app/app.css" rel="stylesheet"/>
</head>
<body>
<div className="container">
    <div className="row">

        <div className="col-md-8">
            <h3>LINE</h3>
        </div>
        <div className="col-md-8">
            <div className="form-group">
                <label htmlFor="id">Id</label>
                <input className="form-control" readOnly type="text" name="id" id="id"/>
            </div>
            <div className="form-group">
                <label htmlFor="timestamp">Timestamp</label>
                <input className="form-control" readOnly type="text" name="timestamp" id="timestamp"/>
            </div>
        </div>
        <div className="col-md-8">
            <h3>REQUEST</h3>
        </div>
        <div className="col-md-8">
            <div className="form-group">
                <label htmlFor="request_method">Method</label>
                <input className="form-control" type="text" name="request_method" id="request_method"/>
            </div>
            <div className="form-group">
                <label htmlFor="request_protocol">Protocol</label>
                <input className="form-control" type="text" name="request_protocol" id="request_protocol"/>
            </div>
            <div className="form-group">
                <label htmlFor="request_host">Host</label>
                <input className="form-control" type="text" name="request_host" id="request_host"/>
            </div>
            <div className="form-group">
                <label htmlFor="request_path">Path</label>
                <input className="form-control" type="text" name="request_path" id="request_path"/>
            </div>
        </div>

        <div className="col-md-8">
            <h4>REQUEST QUERY</h4>
        </div>
        <div className="col-md-8">
            <table className="table table-striped" id="request_queryTable">
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                </tr>
            </table>
        </div>
        <div className="col-md-8">
            <h4>REQUEST HEADERS</h4>
        </div>
        <div className="col-md-8">
            <table className="table table-striped" id="request_headerTable">
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                </tr>
            </table>
        </div>

        <div className="col-md-8">
            <h3>RESPONSE</h3>
        </div>

        <div className="col-md-8">
            <div className="form-group">
                <label htmlFor="response_code">Status Code</label>
                <input className="form-control" type="text" name="response_code" id="response_code"/>
            </div>
        </div>
        <div className="col-md-8">
            <h4>RESPONSE HEADERS</h4>
        </div>
        <div className="col-md-8">
            <table className="table table-striped" id="response_headerTable">
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                </tr>
            </table>
        </div>
    </div>
</div>
<script src="app/app.js"></script>
<script>
    var requestHeaders = [];

    $.ajax({
        url: "/api/recording/" + getUrlParameter("id")+"/line/"+getUrlParameter("line"),
        type: 'GET',
        success: function (res) {
            $("#timestamp").val(res['timestamp']);
            $("#id").val(res['id']);

            //Request
            $("#request_method").val(res['request']['method']);
            $("#request_protocol").val(res['request']['protocol']);
            $("#request_host").val(res['request']['host']);
            $("#request_path").val(res['request']['path']);
            $.each(res["request"]["headers"], function (i, v) {
                if(v.length>60)v= v.substr(0,60);
                var line = {key:i,value:v};
                appendToTable(requestHeaders, "request_headerTable", "key", line, ["key","value"]);
            });
            $.each(res["request"]["query"], function (i, v) {
                if(v.length>60)v= v.substr(0,60);
                var line = {key:i,value:v};
                appendToTable(requestHeaders, "request_queryTable", "key", line, ["key","value"]);
            });

            //Response
            $("#response_code").val(res['response']['statusCode']);
            $.each(res["response"]["headers"], function (i, v) {
                if(v.length>60)v= v.substr(0,60);
                var line = {key:i,value:v};
                appendToTable(requestHeaders, "response_headerTable", "key", line, ["key","value"]);
            });
        }
    });



    function editlineTable(lineId) {
        location.href = "line.html?line=" + lineId + "&id=" + getUrlParameter("id");
    }

    function deletelineTable(lineId) {
        deleteFromTable(lines, "lineTable", "id", lineId, "Line", function (id, success, error) {
            $.ajax({
                url: "/api/recording/" + getUrlParameter("id") + "/line/x" + lineId,
                type: 'DELETE',
                success: function (res) {
                    success();
                },
                error: function (res) {
                    error();
                }
            });
        });
    }
</script>
</body>
</html>